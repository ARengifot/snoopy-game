workflows:
  web-build:
    name: Web Build
    instance_type: linux
    max_build_duration: 30
    
    environment:
      node: 18.x
      npm: 9.x

    scripts:
      - name: Install dependencies
        script: npm install
      
      - name: Build web app
        script: |
          echo "âœ… Web app ready - Snoopy vs Zombies"
          mkdir -p build
          cp index.html build/
          cp -r *.js build/ 2>/dev/null || true
          cp -r *.css build/ 2>/dev/null || true
          cp -r *.png build/ 2>/dev/null || true
          cp -r *.jpg build/ 2>/dev/null || true
          cp manifest.json build/

    artifacts:
      - build/**/*

    publishing:
      email:
        recipients:
          - tu-email@example.com
        notify:
          success: true
          failure: true

  android-build:
    name: Android Build (Cordova)
    instance_type: linux
    max_build_duration: 60
    
    environment:
      java: 11
      node: 18.x
      npm: 9.x
      android_sdk: 33
      ndk: 23.1.7779620

    scripts:
      - name: Install Cordova
        script: npm install -g cordova

      - name: Create Cordova project
        script: |
          cordova create snoopy-android com.game.snoopy SnoopyVsZombies
          cd snoopy-android
          cordova platform add android

      - name: Add web files to www folder
        script: |
          cd snoopy-android
          cp ../index.html www/
          cp ../*.js www/ 2>/dev/null || true
          cp ../*.css www/ 2>/dev/null || true
          cp ../*.png www/ 2>/dev/null || true
          cp ../*.jpg www/ 2>/dev/null || true
          cp ../manifest.json www/

      - name: Build APK
        script: |
          cd snoopy-android
          cordova build android --release

    artifacts:
      - snoopy-android/platforms/android/app/build/outputs/apk/release/**/*.apk

    publishing:
      email:
        recipients:
          - tu-email@example.com
        notify:
          success: true
          failure: true
          cd react-app
          npm install
          cd ios
          pod install

      - name: Build for iOS
        script: |
          cd react-app/ios
          xcodebuild -workspace SnoopyGame.xcworkspace -scheme SnoopyGame -configuration Release

    artifacts:
      - react-app/ios/build/**/*.ipa

  react-native-android:
    name: React Native Android Build
    instance_type: linux_x2
    max_build_duration: 60

    environment:
      java: 11
      ndk: 21.4.7075529
      cmake: 3.10.2
      node: 18.x

    scripts:
      - name: Install dependencies
        script: |
          cd react-app
          npm install

      - name: Build for Android
        script: |
          cd react-app/android
          ./gradlew assembleRelease

    artifacts:
      - react-app/android/app/build/outputs/**/*.apk
